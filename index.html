<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrthodontiC - Sistema de Profilaxia v4.0</title>

    <!-- Evita 404 do favicon.ico -->
    <link rel="icon" href="data:,">

    <!-- CSS -->
    <link rel="stylesheet" href="styles_v3.css">

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- ‚úÖ SUPABASE SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- ‚úÖ App Scripts -->
    <script src="supabase-service.js" defer></script>
    <!-- Cache-bust para garantir que o navegador pegue a vers√£o nova do app.js -->
    <script src="app.js?v=2025-11-02-01" defer></script>
</head>
<body>
    <div id="app">
        <!-- ========================================== -->
        <!-- TELA DE LOGIN -->
        <!-- ========================================== -->
        <div class="screen active" id="loginScreen">
            <div class="login-container">
                <div class="login-card">
                    <img src="logo1.jpg" alt="OrthodontiC" class="login-logo">
                    <h1>Sistema de Profilaxia</h1>
                    <p class="subtitle">Campanha de Limpeza Dental v4.0</p>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="username">Usu√°rio</label>
                            <input type="text" id="username" required autocomplete="username">
                        </div>
                        <div class="form-group">
                            <label for="password">Senha</label>
                            <input type="password" id="password" required autocomplete="current-password">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Entrar</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- APP PRINCIPAL -->
        <!-- ========================================== -->
        <div class="screen" id="mainApp">
            <!-- Header -->
            <header class="app-header">
                <div class="header-content">
                    <div style="display: flex; align-items: center;">
                        <img src="logo1.jpg" alt="OrthodontiC" class="header-logo">
                        <h1>Profilaxia</h1>
                    </div>
                    <div class="user-info">
                        <span id="userNameDisplay"></span>
                        <button class="btn btn-secondary btn-sm" id="logoutBtn">Sair</button>
                    </div>
                </div>
                <nav class="main-nav">
                    <button class="nav-btn active" data-page="dashboard">Dashboard</button>
                    <button class="nav-btn" data-page="cadastro">Novo Registro</button>
                    <button class="nav-btn" data-page="naoAgendados">N√£o Agendados</button>
                    <button class="nav-btn" data-page="agendados">Agendados</button>
                    <button class="nav-btn" data-page="pagamentos">Pagamentos</button>
                    <button class="nav-btn nav-btn-gestao" data-page="gestao" style="display: none;">‚öôÔ∏è Gest√£o</button>
                </nav>
            </header>

            <!-- ========================================== -->
            <!-- P√ÅGINA: DASHBOARD -->
            <!-- ========================================== -->
            <div class="page active" id="dashboardPage">
                <div class="page-header">
                    <h2>Dashboard de Monitoramento</h2>
                    <div class="dashboard-controls">
                        <select class="form-control" id="mesDashboard"></select>
                        <button class="btn btn-secondary" id="refreshDashboard">üîÑ Atualizar</button>
                    </div>
                </div>

                <!-- Placar Semanal -->
                <div class="placar-semanal">
                    <h3>üèÜ PLACAR DA SEMANA ATUAL</h3>
                    <div class="placar-numero" id="placarSemanal">0</div>
                    <div class="placar-info">Limpezas Pagas esta Semana</div>
                    <div class="placar-comparacao" id="placarComparacao">Carregando...</div>
                </div>

                <!-- KPIs -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">‚úÖ</div>
                        <div class="kpi-content">
                            <h3 id="totalAgendadas">0</h3>
                            <p>Limpezas Agendadas</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">‚è≥</div>
                        <div class="kpi-content">
                            <h3 id="totalNaoAgendadas">0</h3>
                            <p>N√£o Agendadas</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üí∞</div>
                        <div class="kpi-content">
                            <h3 id="totalPagas">0</h3>
                            <p>Limpezas Pagas</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üìä</div>
                        <div class="kpi-content">
                            <h3 id="taxaConversao">0%</h3>
                            <p>Taxa de Convers√£o</p>
                        </div>
                    </div>
                </div>

                <!-- ==== NOVOS BLOCOS DO DASHBOARD ==== -->
                <!-- Placar de Comiss√£o (mensal) -->
                <div id="placar-comissao-container"></div>

                <!-- Ranking de Dentistas (Agendado / N√£o Agendado / Pago) -->
                <div id="ranking-dentistas-3col-container" style="margin-top:16px;"></div>
            </div>

            <!-- ========================================== -->
            <!-- P√ÅGINA: CADASTRO -->
            <!-- ========================================== -->
            <div class="page" id="cadastroPage">
                <div class="page-header">
                    <h2>Novo Registro de Encaminhamento</h2>
                </div>
                <div class="card">
                    <form id="cadastroForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="codigoPaciente">C√≥digo do Paciente *</label>
                                <input type="text" id="codigoPaciente" required>
                            </div>
                            <div class="form-group">
                                <label for="nomePaciente">Nome do Paciente *</label>
                                <input type="text" id="nomePaciente" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dentista">Dentista *</label>
                                <select id="dentista" required>
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Status *</label>
                            <div class="btn-group">
                                <button type="button" class="btn-status selected" data-status="agendada">‚úÖ Agendada</button>
                                <button type="button" class="btn-status" data-status="nao_agendada">‚è≥ N√£o Agendada</button>
                            </div>
                            <input type="hidden" id="statusEncaminhamento" value="agendada">
                        </div>
                        <div class="form-group" id="groupPagouNaHora">
                            <label>
                                <input type="checkbox" id="pagouNaHora">
                                üí∞ Pagou Imediatamente (no ato do agendamento)
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="observacoes">Observa√ß√µes</label>
                            <textarea id="observacoes" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Encaminhamento</button>
                    </form>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- P√ÅGINA: N√ÉO AGENDADOS -->
            <!-- ========================================== -->
            <div class="page" id="naoAgendadosPage">
                <div class="page-header">
                    <h2>Pacientes N√£o Agendados</h2>
                </div>
                <div class="card">
                    <div class="table-responsive">
                        <table class="table" id="tableNaoAgendados">
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Paciente</th>
                                    <th>Dentista</th>
                                    <th>Data Registro</th>
                                    <th>Dias Pendente</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- P√ÅGINA: AGENDADOS - ‚úÖ CORRIGIDO -->
            <!-- ========================================== -->
            <div class="page" id="agendadosPage">
                <div class="page-header">
                    <h2>Pacientes Agendados</h2>
                </div>
                <div class="card">
                    <div class="filters-row">
                        <input type="text" id="searchAgendados" class="form-control" placeholder="Buscar por c√≥digo ou nome...">
                        <select id="filterDentistaAgendados" class="form-control">
                            <option value="">Todos os dentistas</option>
                        </select>
                        <select id="filterStatusAgendados" class="form-control">
                            <option value="">Todos os status</option>
                            <option value="nao_pago">N√£o Pago</option>
                            <option value="pagou_na_hora">Pagou na Hora</option>
                            <option value="pago">Pago</option>
                        </select>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="tableAgendados">
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Paciente</th>
                                    <th>Dentista</th>
                                    <th>Data</th>
                                    <th>Status Pagamento</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- P√ÅGINA: PAGAMENTOS -->
            <!-- ========================================== -->
            <div class="page" id="pagamentosPage">
                <div class="page-header">
                    <h2>Registro de Pagamentos</h2>
                </div>
                <div class="card">
                    <div class="table-responsive">
                        <table class="table" id="tablePagamentos">
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Paciente</th>
                                    <th>Dentista</th>
                                    <th>Status</th>
                                    <th>Data</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- P√ÅGINA: GEST√ÉO -->
            <!-- ========================================== -->
            <div class="page" id="gestaoPage">
                <div class="page-header">
                    <h2>‚öôÔ∏è Gest√£o do Sistema</h2>
                </div>

                <!-- Dentistas -->
                <div class="card">
                    <h3>Dentistas Cadastrados</h3>
                    <div class="table-responsive">
                        <table class="table" id="tableDentistas">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Tipo</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- Funcion√°rios -->
                <div class="card">
                    <h3>Funcion√°rios Cadastrados</h3>
                    <div class="table-responsive">
                        <table class="table" id="tableFuncionarios">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Usu√°rio</th>
                                    <th>Perfil</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div> <!-- /page gestao -->
        </div> <!-- /screen mainApp -->
    </div> <!-- /app -->
</body>
</html>
